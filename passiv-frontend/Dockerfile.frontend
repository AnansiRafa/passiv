FROM node:20

WORKDIR /app

# Copy only package definitions first
COPY package*.json ./

# Force clean esbuild install for correct platform
RUN npm install --omit=dev && \
    npm rebuild esbuild --platform=linux --arch=arm64 && \
    npm install

# Copy rest of the code
COPY . .

CMD ["npm", "run", "dev"]
